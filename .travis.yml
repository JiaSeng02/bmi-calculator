language: node_js
node_js:
  - 14
cache: npm

services:
  - docker  # Enable Docker service in Travis CI

before_install:
  - docker --version  # Check Docker version for debugging
  - npm install -g npm@6.9.0

install:
  - npm install
  - npm install react-script@latest

script:
  - npm run build               # Build the application

after_success:
  # Report test coverage to Codecov
  - CODECOV_TOKEN=$codecov_token npm run report-coverage

  # Authenticate Docker with Docker Hub
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  
  # Build Docker image using the Dockerfile
  - docker build -t your_dockerhub_username/your_app_name:$TRAVIS_COMMIT .
  
  # Push Docker image to Docker Hub
  - docker push your_dockerhub_username/your_app_name:$TRAVIS_COMMIT

after_failure:
  - cat /home/travis/.npm/_logs/*-debug.log

after_script:
  # Report to Coveralls
  - COVERALLS_REPO_TOKEN=$coveralls_repo_token npm run coveralls

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN ${{ secrets.GITHUB_TOKEN }}
  local_dir: build
  on:
    branch: master